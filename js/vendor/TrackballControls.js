THREE.TrackballControls=function(a,b){function w(a){c.enabled!==!1&&(window.removeEventListener("keydown",w),h=g,g===d.NONE&&(a.keyCode!==c.keys[d.ROTATE]||c.noRotate?a.keyCode!==c.keys[d.ZOOM]||c.noZoom?a.keyCode!==c.keys[d.PAN]||c.noPan||(g=d.PAN):g=d.ZOOM:g=d.ROTATE))}function x(){c.enabled!==!1&&(g=h,window.addEventListener("keydown",w,!1))}function y(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g===d.NONE&&(g=a.button),g!==d.ROTATE||c.noRotate?g!==d.ZOOM||c.noZoom?g!==d.PAN||c.noPan||(p.copy(u(a.pageX,a.pageY)),q.copy(p)):(l.copy(u(a.pageX,a.pageY)),m.copy(l)):(j.copy(v(a.pageX,a.pageY)),k.copy(j)),document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",A,!1),c.dispatchEvent(s))}function z(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g!==d.ROTATE||c.noRotate?g!==d.ZOOM||c.noZoom?g!==d.PAN||c.noPan||q.copy(u(a.pageX,a.pageY)):m.copy(u(a.pageX,a.pageY)):k.copy(v(a.pageX,a.pageY)))}function A(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g=d.NONE,document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",A),c.dispatchEvent(t))}function B(a){if(c.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),l.y+=.01*b,c.dispatchEvent(s),c.dispatchEvent(t)}}function C(a){if(c.enabled!==!1){switch(a.touches.length){case 1:g=d.TOUCH_ROTATE,j.copy(v(a.touches[0].pageX,a.touches[0].pageY)),k.copy(j);break;case 2:g=d.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;o=n=Math.sqrt(b*b+e*e);var f=(a.touches[0].pageX+a.touches[1].pageX)/2,h=(a.touches[0].pageY+a.touches[1].pageY)/2;p.copy(u(f,h)),q.copy(p);break;default:g=d.NONE}c.dispatchEvent(s)}}function D(a){if(c.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:k.copy(v(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;o=Math.sqrt(b*b+e*e);var f=(a.touches[0].pageX+a.touches[1].pageX)/2,h=(a.touches[0].pageY+a.touches[1].pageY)/2;q.copy(u(f,h));break;default:g=d.NONE}}function E(a){if(c.enabled!==!1){switch(a.touches.length){case 1:k.copy(v(a.touches[0].pageX,a.touches[0].pageY)),j.copy(k);break;case 2:n=o=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;q.copy(u(b,e)),p.copy(q)}g=d.NONE,c.dispatchEvent(t)}}var c=this,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var e=1e-6,f=new THREE.Vector3,g=d.NONE,h=d.NONE,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector2,m=new THREE.Vector2,n=0,o=0,p=new THREE.Vector2,q=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var r={type:"change"},s={type:"start"},t={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var u=function(){var a=new THREE.Vector2;return function(b,d){return a.set((b-c.screen.left)/c.screen.width,(d-c.screen.top)/c.screen.height),a}}(),v=function(){var a=new THREE.Vector3,b=new THREE.Vector3,d=new THREE.Vector3;return function(e,f){d.set((e-.5*c.screen.width-c.screen.left)/(.5*c.screen.width),(.5*c.screen.height+c.screen.top-f)/(.5*c.screen.height),0);var g=d.length();return c.noRoll?d.z=g<Math.SQRT1_2?Math.sqrt(1-g*g):.5/g:g>1?d.normalize():d.z=Math.sqrt(1-g*g),i.copy(c.object.position).sub(c.target),a.copy(c.object.up).setLength(d.y),a.add(b.copy(c.object.up).cross(i).setLength(d.x)),a.add(i.setLength(d.z)),a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var d=Math.acos(j.dot(k)/j.length()/k.length());d&&(a.crossVectors(j,k).normalize(),d*=c.rotateSpeed,b.setFromAxisAngle(a,-d),i.applyQuaternion(b),c.object.up.applyQuaternion(b),k.applyQuaternion(b),c.staticMoving?j.copy(k):(b.setFromAxisAngle(a,d*(c.dynamicDampingFactor-1)),j.applyQuaternion(b)))}}(),this.zoomCamera=function(){if(g===d.TOUCH_ZOOM_PAN){var a=n/o;n=o,i.multiplyScalar(a)}else{var a=1+(m.y-l.y)*c.zoomSpeed;1!==a&&a>0&&(i.multiplyScalar(a),c.staticMoving?l.copy(m):l.y+=(m.y-l.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,d=new THREE.Vector3;return function(){a.copy(q).sub(p),a.lengthSq()&&(a.multiplyScalar(i.length()*c.panSpeed),d.copy(i).cross(c.object.up).setLength(a.x),d.add(b.copy(c.object.up).setLength(a.y)),c.object.position.add(d),c.target.add(d),c.staticMoving?p.copy(q):p.add(a.subVectors(q,p).multiplyScalar(c.dynamicDampingFactor)))}}(),this.checkDistances=function(){c.noZoom&&c.noPan||(i.lengthSq()>c.maxDistance*c.maxDistance&&c.object.position.addVectors(c.target,i.setLength(c.maxDistance)),i.lengthSq()<c.minDistance*c.minDistance&&c.object.position.addVectors(c.target,i.setLength(c.minDistance)))},this.update=function(){i.subVectors(c.object.position,c.target),c.noRotate||c.rotateCamera(),c.noZoom||c.zoomCamera(),c.noPan||c.panCamera(),c.object.position.addVectors(c.target,i),c.checkDistances(),c.object.lookAt(c.target),f.distanceToSquared(c.object.position)>e&&(c.dispatchEvent(r),f.copy(c.object.position))},this.reset=function(){g=d.NONE,h=d.NONE,c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.up.copy(c.up0),i.subVectors(c.object.position,c.target),c.object.lookAt(c.target),c.dispatchEvent(r),f.copy(c.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",y,!1),this.domElement.addEventListener("mousewheel",B,!1),this.domElement.addEventListener("DOMMouseScroll",B,!1),this.domElement.addEventListener("touchstart",C,!1),this.domElement.addEventListener("touchend",E,!1),this.domElement.addEventListener("touchmove",D,!1),window.addEventListener("keydown",w,!1),window.addEventListener("keyup",x,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;